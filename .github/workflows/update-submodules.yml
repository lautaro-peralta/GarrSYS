name: Update Submodules

on:
  schedule:
    - cron: "0 18 * * *" # Todos los d√≠as a las 18:00 UTC (15:00 Argentina aprox)
  workflow_dispatch: # Permite ejecuci√≥n manual

jobs:
  update-submodules:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_SYNC }}
          submodules: true
          fetch-depth: 0

      - name: Configurar git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Actualizar subm√≥dulos a los √∫ltimos commits
        run: |
          git submodule update --remote --recursive
          git add .
          if git diff --cached --quiet; then
            echo "No hay cambios en los subm√≥dulos."
            exit 0
          fi

      - name: Set date
        run: echo "DATE=$(date +'%Y-%m-%d')" >> $GITHUB_ENV

      - name: Crear Pull Request autom√°tico
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.PAT_SYNC }}
          branch: ci/update-submodules-${{ github.run_id }}
          base: main
          title: "chore: update submodule references (${{ env.DATE }})"
          body: |
            ü§ñ **Actualizaci√≥n autom√°tica de referencias de subm√≥dulos**

            - `apps/frontend` ‚Üí √öltimos cambios desde [`Tsplivalo/TGS-Frontend`](https://github.com/Tsplivalo/TGS-Frontend)
            - `apps/backend` ‚Üí √öltimos cambios desde [`lautaro-peralta/TGS-Backend`](https://github.com/lautaro-peralta/TGS-Backend)

            _Este pull request fue generado autom√°ticamente por GitHub Actions._
          commit-message: "[create-pull-request] automated submodule update"
          committer: "github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>"
          author: "lautaro-peralta <205333171+lautaro-peralta@users.noreply.github.com>"
          delete-branch: true
          signoff: false
